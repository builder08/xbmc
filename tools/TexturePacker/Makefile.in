DEFINES += -D_LINUX -DUSE_LZO_PACKING
ifneq ($(or $(findstring powerpc,arm-osx),$(findstring ppc, arm-osx)),)
DEFINES += -DHOST_BIGENDIAN
endif

CXXFLAGS+= \
  -I. \
  -I@abs_top_srcdir@/lib \
  -I@abs_top_srcdir@/xbmc \
  -I@abs_top_srcdir@/xbmc/linux

ifeq (@USE_TEXTUREPACKER_NATIVE@,1)
NATIVE_ROOT_PATH=@USE_TEXTUREPACKER_NATIVE_ROOT@
ifdef NATIVE_ROOT_PATH
CXXFLAGS+= -I$(NATIVE_ROOT_PATH)/include
LIBS    += -L$(NATIVE_ROOT_PATH)/lib
endif
LIBS    += -L@abs_top_srcdir@/lib/libsquish -lsquish-native
else
LIBS    += -L@abs_top_srcdir@/lib/libsquish -lsquish
endif

ifeq (@USE_PVRTEXLIB@,1)
ifeq ($(shell uname),Darwin)
PVR_LIB  = @abs_top_srcdir@/lib/libPVRTexLib/PVRTexLib/MacOS_x86
else
ifeq ($(shell uname -m),x86_64)
PVR_LIB  = @abs_top_srcdir@/lib/libPVRTexLib/PVRTexLib/Linux_x86_64
else
PVR_LIB  = @abs_top_srcdir@/lib/libPVRTexLib/PVRTexLib/Linux_x86_32
endif
endif
DEFINES += -DUSE_PVR_COMPRESSION
CXXFLAGS+= -I@abs_top_srcdir@/lib/libPVRTexLib/PVRTexLib
LIBS    += -L$(PVR_LIB) -lPVRTexLib
endif

LIBS    += -lSDL_image -lSDL -llzo2

SRCS = \
  md5.cpp \
  SDL_anigif.cpp \
  XBTFWriter.cpp \
  XBMCTex.cpp \
  @abs_top_srcdir@/xbmc/guilib/XBTF.cpp


TARGET = TexturePacker
CLEAN_FILES=$(TARGET)

all: $(TARGET)

ifeq (@USE_TEXTUREPACKER_NATIVE@,1)
# TexturePacker run native on build system, build it with native tools
$(TARGET): $(SRCS)
ifeq (@USE_PVRTEXLIB@,1)
	make -C @abs_top_srcdir@/lib/libPVRTexLib
endif
	g++ $(DEFINES) $(CXXFLAGS) $(SRCS) $(LIBS) -o $(TARGET)
clean:
ifeq (@USE_PVRTEXLIB@,1)
	make -C @abs_top_srcdir@/lib/libPVRTexLib clean
endif
	rm -f $(TARGET)
else
include @abs_top_srcdir@/Makefile.include

$(TARGET): $(SRCS)
	$(CXX) $(CXXFLAGS) $(DEFINES) $(INCLUDES) $(SRCS) $(LDFLAGS) $(LIBS) -o $(TARGET)
endif
