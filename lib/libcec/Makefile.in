#  Download and build libCEC
#
#  Usage:
#    make download
#    make bootstrap
#    make configure
#    make

# lib name, version
LIBNAME=libcec
VERSION=0.6
ARCHIVE=$(LIBNAME)-$(VERSION)

# download location and format
ARCHIVE_BASE_URL=http://github.com/Pulse-Eight/$(LIBNAME)/tarball/
ARCHIVE_EXTRACTED_DIR=Pulse-Eight-libcec-d9ba5be
ARCHIVE_URL=$(ARCHIVE_BASE_URL)$(ARCHIVE)
ARCHIVE_TOOL=tar
ARCHIVE_TOOL_FLAGS=xf
ARCHIVE_ADD_EXTENSION=.tar.gz
RETRIEVE_TOOL=/usr/bin/curl
RETRIEVE_TOOL_FLAGS=-Ls --create-dirs --output $(ARCHIVE)$(ARCHIVE_ADD_EXTENSION)

# configuration
PREFIX ?= @abs_top_srcdir@/lib/libcec
LIBCEC_CONFIGOPTS ?= --prefix=$(PREFIX)
CONFIGURE=./configure CFLAGS=-D_FILE_OFFSET_BITS=64 $(LIBCEC_CONFIGOPTS)

all: libcec.a

download: distclean
	$(RETRIEVE_TOOL) $(RETRIEVE_TOOL_FLAGS) $(ARCHIVE_URL)
	$(ARCHIVE_TOOL) $(ARCHIVE_TOOL_FLAGS) $(ARCHIVE)$(ARCHIVE_ADD_EXTENSION)
	rm -f $(ARCHIVE)$(ARCHIVE_ADD_EXTENSION)
	mv $(ARCHIVE_EXTRACTED_DIR) $(LIBNAME)
	mkdir -p include/libcec
	cp $(LIBNAME)/include/* include/libcec

libcec.a:
	make -C $(LIBNAME)
	cp $(LIBNAME)/src/lib/.libs/libcec.a libcec.a

clean:
	rm -f libcec.a
	make -C $(LIBNAME) clean

distclean:
	rm -f $(ARCHIVE) libcec.a Makefile
	rm -rf include
	rm -rf $(LIBNAME)
	rm -rf $(ARCHIVE_DIR)
